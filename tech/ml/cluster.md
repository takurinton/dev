---
title: クラスタについて
head:
  - - meta
    - name: og:title
      content: クラスタについて
  - - meta
    - name: twitter:title
      content: クラスタについて
  - - meta
    - name: og:description
      content: クラスタとグループの違い、デンドログラムについてまとめた
  - - meta
    - name: twitter:description
      content: クラスタとグループの違い、デンドログラムについてまとめた
  - - meta
    - name: og:image
      content: https://res.cloudinary.com/dtapptgdd/image/upload/w_1000/l_text:Sawarabi Gothic_70_bold:クラスタについて/v1620370500/Screen_Shot_2021-05-07_at_15.54.47_extlvu.png
  - - meta
    - name: twitter:image
      content: https://res.cloudinary.com/dtapptgdd/image/upload/w_1000/l_text:Sawarabi Gothic_70_bold:クラスタについて/v1620370500/Screen_Shot_2021-05-07_at_15.54.47_extlvu.png
---

# {{ $frontmatter.title }}

## クラスタ分析

クラスタ分析とは対象間の距離を定義して距離の近さによって対象を分類する統計手法の一つである。  
簡単に言うと似たもの同士を見つけるための方法である。  
クラスタ分析には階層的クラスタリングと非階層的クラスタリングの2種類がある。  

## クラスタについて

そもそもクラスタとは何かについてだが、クラスタとは集団、郡などの意味を持つ。  
また、人間が任意の条件で分類したものはクラスタではなくグループと呼ぶ。例えば小学生の運動会の赤組、青組などはグループである。  
クラスタは距離の近さによって分類する手法なので、似たもの同士で分類しているという感じである。分類する側に人間の意思が働けばグループ、そうでなければクラスタと考えていい。
<!-- クラスタは距離の近さによって分類する手法なので、似たもの同士で分類してる。コロナでクラスタ感染という言葉があるが、あれは自分の欲を抑えることができず、3密を生み出してしまった低知能な人間をクラスタリングした結果であり、グループとは区別するべきである。 -->

## 階層的クラスタリング　

階層的クラスタリングでは結果はデンドログラムとして扱われる。デンドログラムは完全クラスタリングと呼ばれ、完璧にクラスタリングされる。デンドログラムはスポーツなどのトーナメント表のような形で表現される。完全クラスタリングを実現する代わりに、データ量が多いと時間がかかってしまう。

階層的クラスタリングのアルゴリズムは最短距離法、最長距離法、群平均法、ウォード法がある。一般的に計算量は 𝑂(𝑁2log𝑁) とされている。
ただし、Lance-Williamsの更新式で定数時間で距離の更新が可能な上記の距離更新手法には可約性 (reducibility) という性質があり，再近隣グラフの性質を活用することで 𝑂(𝑁2) の時間で計算可能なアルゴリズムが知られている。  

#### python でのデンドログラムの表現

python ではデンドログラムがとても簡単に表現することができる。  
使用するライブラリは `pandas`、`numpy`、`matplotlib`、`scipy` である。  

今回は乱数を使用してクラスタリングを行う。  


```python
import pandas as pd 
import numpy as np
from scipy.cluster.hierarchy import dendrogram, linkage, fcluster
import matplotlib.pyplot as plt

df = pd.DataFrame(np.random.rand(16*21).reshape(21,16)) # 適当な値を格納する
Z = linkage(df, method='ward', metric='euclidean')
```

Z を出力すると以下のようになる。コメントアウトしてる部分が出力結果である。  

```python
print(Z)
# [[11.         16.          1.07569096  2.        ]
#  [10.         19.          1.20989437  2.        ]
#  [ 4.         15.          1.24983718  2.        ]
#  [ 6.         14.          1.27961914  2.        ]
#  [22.         23.          1.30262426  4.        ]
#  [ 8.         12.          1.30865321  2.        ]
#  [ 7.         13.          1.31970314  2.        ]
#  [ 1.          2.          1.3569622   2.        ]
#  [ 5.         18.          1.36003759  2.        ]
#  [ 0.         20.          1.38985074  2.        ]
#  [17.         21.          1.59515131  3.        ]
#  [28.         30.          1.62814148  4.        ]
#  [ 3.         26.          1.65895643  3.        ]
#  [ 9.         27.          1.75510187  3.        ]
#  [25.         29.          1.90373766  6.        ]
#  [31.         33.          2.01135602  6.        ]
#  [24.         35.          2.1351386   8.        ]
#  [32.         36.          2.16289886 10.        ]
#  [34.         38.          2.25559914 13.        ]
#  [37.         39.          2.49505445 21.        ]]
```

また、これを使用してデンドログラムを作成する。

```python
dendrogram(Z)
plt.show()
```

たったこれだけである。  
出力結果は以下のようになる。  

![dendrogram](/public/dendrogram.png)  

これは下に行けば行くほど似ている、上に行けば行くほど似ていないことを表している。  
非常に簡単にデンドログラムを表示することができた。

## 非階層的クラスタリング

非階層的クラスタリングは結果がデンドログラムではなくただ単にグルーピングがされた状態で表される。  
非階層的クラスタリングでは k-means 法が有名である。  
k-means 法は理解している（ちょっと忘れているが概念は理解しているし思い出すのは早いと思う）ので省略する。  
非階層的クラスタリングは k-means 法のようなものという認識だけ持っておくことにする。  
